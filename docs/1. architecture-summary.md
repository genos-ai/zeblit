# Architecture Quick Reference for AI Coding Assistant

## ğŸ¯ Project Overview
Building a browser-based AI development platform (like Replit) with 6 AI agents that collaborate to build applications through natural language.

## ğŸ—ï¸ Architecture Diagrams Created
1. **System Architecture**: Overall component layout and connections
2. **Request Flow**: Step-by-step sequence of user request processing
3. **Container Architecture**: User environment lifecycle and management
4. **Component Breakdown**: Detailed view of services and modules

## ğŸ“ Project Structure
```
ai-dev-platform/
â”œâ”€â”€ frontend/               # React + TypeScript + Vite
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/    # UI components
â”‚   â”‚   â”œâ”€â”€ pages/        # Route pages
â”‚   â”‚   â”œâ”€â”€ hooks/        # Custom hooks
â”‚   â”‚   â”œâ”€â”€ services/     # API clients
â”‚   â”‚   â””â”€â”€ types/        # TypeScript types
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/               # Python + FastAPI
â”‚   â”œâ”€â”€ api/              # REST endpoints
â”‚   â”œâ”€â”€ agents/           # AI agent implementations
â”‚   â”œâ”€â”€ services/         # Business logic
â”‚   â”œâ”€â”€ models/           # SQLAlchemy models
â”‚   â”œâ”€â”€ integrations/     # External APIs (Claude, etc.)
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ infrastructure/        # Docker + K8s configs
â”‚   â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ kubernetes/
â”‚   â””â”€â”€ docker-compose.yml
â”‚
â””â”€â”€ shared/               # Shared types/contracts
    â””â”€â”€ api-spec.yaml     # OpenAPI specification
```

## ğŸ”‘ Key Technical Decisions

### Backend Stack
- **Framework**: FastAPI (async Python)
- **Database**: PostgreSQL + SQLAlchemy ORM
- **Cache/Queue**: Redis for pub/sub and caching
- **Task Queue**: Celery for background jobs
- **WebSockets**: Native FastAPI WebSocket support

### Frontend Stack
- **Framework**: React 18 with TypeScript
- **Build Tool**: Vite for fast development
- **UI Library**: Tailwind CSS + shadcn/ui
- **Code Editor**: Monaco Editor (VS Code engine)
- **State Management**: TanStack Query + Context API
- **WebSocket Client**: Native WebSocket API

### AI Integration
- **Primary LLM**: Claude 3.5 Sonnet (80%) and Claude 3 Opus (20%)
- **Direct API**: No complex frameworks, just Anthropic SDK
- **Message Bus**: Redis pub/sub for agent coordination
- **Cost Control**: Automatic model selection based on complexity

### Container Platform
- **Development**: OrbStack on macOS (better than Docker Desktop)
- **Production**: Kubernetes (AKS or on-premise)
- **User Isolation**: One container per user/project
- **Resources**: 1-2 CPU, 2-4GB RAM, 10GB storage per container

## ğŸš€ Implementation Priority

### Phase 1: Core Platform (Month 1-3)
```python
# 1. Basic FastAPI structure
from fastapi import FastAPI, WebSocket
app = FastAPI()

# 2. Docker Compose for services
# 3. Basic authentication
# 4. Container management
# 5. Simple UI with Monaco editor
```

### Phase 2: Agent System (Month 3-4)
```python
# 1. Base agent class
class BaseAgent:
    async def process_task(self, task):
        # Claude integration
        response = await claude.messages.create(...)
        
# 2. Message bus setup
# 3. Single agent working (Engineer)
# 4. WebSocket real-time updates
```

### Phase 3: Full Integration (Month 4-6)
```python
# 1. All 6 agents implemented
# 2. Git integration
# 3. Preview functionality
# 4. Cost tracking
# 5. Production deployment
```

## ğŸ’¡ Key Implementation Tips

1. **Start Simple**: Use Docker Compose before Kubernetes
2. **Direct LLM Calls**: Don't overcomplicate with frameworks
3. **Redis for Everything**: Cache, queues, pub/sub, sessions
4. **One App Per User**: Simplifies state management
5. **Agent Isolation**: Each agent on its own Redis channel
6. **Cost First**: Implement token tracking from day one
7. **Security**: JWT auth, container isolation, audit logging

## ğŸ”— Critical Integrations
- **Anthropic API**: For Claude models (primary)
- **Resend**: For email notifications
- **Git**: For version control
- **OrbStack/Docker API**: For container management
- **PostgreSQL**: For persistent data
- **Redis**: For real-time communication

## ğŸ“Š Database Schema Overview
- `users`: Authentication and roles
- `projects`: User projects/apps
- `tasks`: Agent task tracking
- `conversations`: Agent chat history
- `costs`: LLM usage tracking
- `containers`: Active container registry

## ğŸ¨ UI Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (Logo, User, Settings)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agent   â”‚ Code Editor    â”‚ App Preview  â”‚
â”‚ Chat    â”‚ (Monaco)       â”‚ (iframe)     â”‚
â”‚ (Left)  â”‚                â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agent Tabs: [Dev][PM][Data][Eng][Arch]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš¨ Common Pitfalls to Avoid
1. Don't use localStorage (not supported in artifacts)
2. Don't overcomplicate agent communication
3. Don't forget container resource limits
4. Don't skip cost tracking implementation
5. Don't allow direct internet access from containers

This architecture provides everything needed to build a secure, scalable, AI-powered development platform!